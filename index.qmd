---
title: "Understanding Brunei's Climate Through Air Temperature Data (Ongoing Project)"
author: Alvin Bong
format: 
  html:
    embed-resources: true
    number-sections: true
    cross-ref: true
    toc: true
    toc-depth: 2
    toc-location: left
    code-links:
      - text: Github Repo
        icon: github
        href: https://github.com/alvinbjl/brunei-climate
      - text: R Script
        href: https://github.com/alvinbjl/brune-climate/blob/main/sourcecode.R
---
To do: <br>

- Check if there is any raw data. Add information on data and location of data.

- Extreme events: Try plotting anomalies (to determine periodicity, spectrum analysis)

- Correlation analysis with Nino. index

- Explore EOF/PCA. Probably need more variables

✅ Feel lack rigor/indepth analysis, mostly EDA for now, consult Dr. Haziq for advice. <br>
    Advice: Since interdiscipline field, need to consult geography background experts, to check if I am asking the right questions.<br>
✅ Discussed with  senior Amir , gained ideas on  project outline (similar to his ongoing project on rainfall analysis.)

# Research Question

Climate change has been prevalent worldwide, causing adverse effects felt by all. Given temperature being one of the most important indicators of climate change, it would be interesting to explore:

-   How has Brunei's temperature evolved over time?
-   Is this consistent with global temperature trends?
-   How temperature varies by month?

# Data Collection and Cleaning

## Data Collection
The dataset is sourced from [`NASA POWER API`](https://power.larc.nasa.gov/) using `{nasapower}` package in R, covering years 1981 to 2023.

```{r include=FALSE}
library(nasapower)
library(tidyverse)
library(plotly)
library(ggplot2)
library(forecast)
library(tsibble)
library(lubridate)
library(stringr)
```

```{r, eval=FALSE}
#| code-fold: true
df <- get_power(
  community = "re",
  lonlat = c(114.9, 4.9),
  pars = c("T2M", "T2M_MAX", "T2M_MIN", "TS", "TS_MAX", "TS_MIN"),
  dates = c("1981-01-01", "2023-12-31"),
  temporal_api = "monthly"
)

write.csv(df, "brunei_temp.csv", row.names = FALSE)
```

## Data Wrangling

```{r}
#| warning: false
df <- read_csv("brunei_temp.csv")
df <- df %>% 
    pivot_longer(cols = 5:16, names_to = "MONTH") %>% 
    select(-ANN, -LON, -LAT) %>% 
    spread(PARAMETER, value)
df$DATE <- ymd(paste(df$YEAR, df$MONTH, "01"))
df <- df %>% arrange(DATE)

t2m_ts <- ts(df$T2M, start = c(1981, 1), frequency = 12)
```

## Variable of interest

NASA provides two temperature-related variables: `T2M` (temperature at 2 meters) and `TS` (surface temperature). A comparison shows that both are highly correlated, making one sufficient for analysis. Since `T2M` better represents the temperature experienced by a person, this project uses `T2M`. However, using `TS` would likely yield similar results.

```{r, echo=FALSE}
#| warning: false
ggplot(df, aes(x = T2M, y = TS)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "TS vs T2M",
    x = "T2M",
    y = "TS"
  ) +
  theme_minimal()
```

# EDA

## Monthly Distribution

From @fig-box-plt, we see that temperature are highest from April to September, with a peak in May, indicating the warmest part of the year. A general cooling trend is observed in the last quarter of the year, with an abrupt temperature drop from December to January. This marks the transition into the coolest part of the year, spanning January to March. During this three months, the average temperature drops below 27°C. 

Another significant observation is that the Range and Interquartile Range (IQR) seems widest in November and January, suggesting higher variability and less consistent temperatures during these months. This could indicate transitional weather patterns.

```{r, echo=FALSE}
#| label: fig-box-plt
boxplot(t2m_ts ~ cycle(t2m_ts), names = month.abb, 
        xlab = NULL, ylab = "Temperature (°C)", 
        main = "Monthly T2M Distribution")
```

## Yearly & Monthly Trend

Although air temperature appears relatively stable in @fig-brn-temp, with quite consistent seasonal cycles, @fig-brn-temp-year reveals a gradual upward trend. Prior to 1990, temperatures hovered around or below 27°C, but in recent years have exceeded 27.5°C. While this may seem negligible, it amounts to approximately **0.9°C over a 50-year period** (assuming the current rate of change holds). This is supported by a linear regression model, which yields a small p-value of $3.64 \times 10^{-10} < 0.01$ and a Pearson correlation coefficient of $\sqrt{0.6207} \approx 0.788$, indicating a moderate to strong positive trend over time and supporting the alternative hypothesis of increasing temperature.

While linear regression may not capture all patterns due to autocorrelated residuals, it still provides useful insight into the general long-term trends. In the following section, we explore alternative modeling approaches for more insights.

Additionally, from @fig-brn-temp-year and @fig-brn-temp, we observe temperature peaks in 1998, 2016, 2019 and 2023. Notably, compared to @fig-brn-temp, the annual plot may appear to have fewer peaks potentially due to monthly autocorrelation smoothing out short-term extremes. Nevertheless, this raises the question: Does Brunei’s extreme heat periods align with the El Niño cycle. How long are the cycles?

```{r, echo=FALSE}
#| warning: false
#| label: fig-brn-temp
#| fig-cap: "Monthly T2M (1981-2023)"
viz <-
  ggplot(df, aes(x = DATE, y = T2M)) +
    geom_line(color = "steelblue") + 
    geom_smooth(method = "lm", se = FALSE, linetype = "dotted", color = "darkred") +
    labs(
      x = NULL,
      y = "Temperature (°C)"
    ) +
    theme_minimal()
ggplotly(viz)
```

```{r, echo=FALSE}
#| warning: false
#| label: fig-brn-temp-year
#| fig-cap: "Annual Mean T2M (1981-2023)"

# Aggregate time series by year (assuming monthly data)
t2m_agg <- aggregate(t2m_ts, FUN = mean)

# Convert to data frame for ggplot
df_t2m <- data.frame(
  Year = as.numeric(time(t2m_agg)),  # Extract time index
  Temperature = as.numeric(t2m_agg)  # Extract values
)

# Create ggplot
p <- ggplot(df_t2m, aes(x = Year, y = Temperature)) +
  geom_line(color = "steelblue", size = 1) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dotted",
              color = "darkred") +
  geom_point(color = "blue", size = 2) +
  labs(title = "Average Yearly Temperature (T2M)",
       x = NULL,
       y = "Temperature (°C)") +
  theme_minimal()

# Convert to interactive plot
ggplotly(p)
```

```{r}
lm_temp <- lm(T2M ~ YEAR, 
              data = df %>% 
                select(YEAR, T2M) %>% 
                group_by(YEAR) %>% 
                summarize(T2M = mean(T2M)))
summary(lm_temp)
```

# Findings
## Extreme Events/Anomalies/ Spectrum Analysis

# Conclusion

This project can be summarised in three main points:

-   Temperature is gradually increasing in Brunei.

-   Brunei is not immune to El Niño effects. Extreme heat in 1998 & 2023 (aligning with global anomalies)

-   May is the hottest month in Brunei.

# Acknowledgements

The author expresses gratitude to NASA POWER for the data used in the project.
